---
title: Linux Shell 标准输入、输出和错误重定向
date: 2017/1/16 9:07:14 
description: 文件描述符是与文件相关联的一些整数，他们保持与已打开文件的关联。众所周知的文件描述符是标准输入stdin、标准输出stdout、标准错误stderr，我们可以重定位这些文件描述符关联文件的内容到另外一个文件文件描述符。
categories: 技术
tags: [shell,linux]
---

### 1. 文件描述符

文件描述符是与文件相关联的一些整数，他们保持与已打开文件的关联。众所周知的文件描述符是标准输入stdin、标准输出stdout、标准错误stderr，我们可以重定位这些文件描述符关联文件的内容到另外一个文件文件描述符。

| 文件描述符 | 文件   | 缺省   |
| ----- | ---- | ---- |
| 0(文件) | 标准输入 | 键盘   |
| 1(文件) | 标准输出 | 屏幕   |
| 2(文件) | 标准错误 | 屏幕   |
系统有12个文件描述符，可以任意使用的文件描述符是3到9

------

### 2. 重定向命令
#### 2.1 输出重定向 

| 命令                                     | 描述                                       |
| -------------------------------------- | ---------------------------------------- |
| Command > filename                     | 把**标准输出**重定向到一个新的文件中                     |
| Command >> filename                    | 把**标准输出**重定向到一个文件中**(追加)**               |
| Command > filename 2>&1                | 把**标准输出**和**标准错误**重定向到一个新的文件中            |
| Command &> filename                    | 同上                                       |
| Command >> filename 2>&1               | 把**标准输出**和**标准错误**重定向到一个文件中**(追加)**      |
| Command &>> filename                   | 同上                                       |
| Command 2 > filename                   | 把**标准错误**重定向到一个新的文件中                     |
| Command 2 >> filename                  | 把**标准错误**重定向到一个文件中**(追加)**               |
| Command 1 > filename 2 > filename      | 把**标准输出**和**标准错误**分别重定向到两个不同新的文件中        |
| Command 1 >> filename1  2 >> filename2 | 把**标准输出**和**标准错误**分别重定向到两个不同的文件中**(追加)** |
| Command  tee filename                | 让**标准输出**在屏幕显示，同时重定向一个新的文件               |
| Command I tee -i filename             | 同上，但是不接受中断信号，只能**Ctrl+D**结束，不能用**Ctrl+C** |
| Command I tee -a filename             | 让**标准输出**在屏幕显示，同时重定向一个文件**(追加)**         |
| Command 2>&1 I tee filename           | 让**标准输出**和**标准错误**在屏幕显示，重定向到一个新的文件中      |
| Command 2>&1 I tee -a filename        | 让**标准输出**和**标准错误**在屏幕显示，重定向到一个文件中**(追加)** |

- 由于网页支持问题，上述表格内容中的I代表|
- **2>&1**为**标准错误**重定向到**标准输出**
- 重定向运算符 '**>**'  '**>>**'的默认参数为标准输出，为1。所以:
  -  '**>**' 等价于'**1>**'
  -  '**>>**'等价于'**1>>**'

#### 2.2 输入重定向 

| 命令                             | 描述                                       |
| ------------------------------ | ---------------------------------------- |
| Command < filename1 >filename2 | Command命令以 filename1 文件作为**标准输入**，以filename2文件作为**标准输出** |
| Command < filename             | Command命令以 filename 文件作为**标准输入**         |
| Command << delimiter           | 从**标准输入**中读入，直到遇到 delimiter 分界符          |

#### 2.3 绑定重定向

| 命令          | 描述                   |
| ----------- | -------------------- |
| Command >&m | 把**标准输出**重定向到文件描述符m中 |
| Command <&m | 读取文件描述符m的**标准输入**    |

----------

### 3.重定向例子

#### 3.1 错误信息重定向空设备

若Command出错，将错误信息重定向到空设备

~~~bash
Command 2 > /dev/null
~~~

#### 3.2 文本块重定向作为标注输入

将文本块重定向到test.txt

~~~bash
cat <<EOF >>test.txt
hello
EOF
~~~

#### 3.3 用户自定义文件描述符

0、1、2为shell保留文件描述符，可以自定义文件描述符，对其进行读写，用户自定义文件描述符用`exec`命令进行创建，创建的文件描述符有三种形式

##### 3.3.1 只读方式

~~~bash
exec descriptor<filename
~~~

只读方式的文件描述符只能读取一次，要再次读取，需要对文件描述符重新打开赋值，以文件描述符3为例

~~~bash
exec 3<test.txt
cat <&3
~~~

如果在读取一次之后，再次执行`cat <&3`，不输入任何内容

##### 3.3.2 截断模式写方式

~~~
exec descriptor>filename
~~~

截断模式相当于重新创建文件，文件之前的内容会被清空，以文件描述符4为例，

~~~bash
exec 4>test.txt
echo "1" >&4
echo "2" >&4
exec 4>test.txt
echo "3" >&4
~~~

最终test.txt的内容为3

##### 3.3.3 追加模式写方式

~~~
exec descriptor>>filename
~~~
写方式的文件描述符只要一次打开便可多次写入，并且后续的写入操作会一直追加到文件的结尾，以文件描述符5为例

~~~bash
exec 5>>test.txt
echo "1" >&5
echo "2" >&5
exec 5>>test.txt
echo "3" >&5
~~~

最后test.txt的结果为 

~~~
1
2
3
~~~

#### 3.4  重定向读取文件

逐行读取一个文件

~~~bash
while read LINE
do
echo $LINE
done < $FILENAME
~~~

---

### 4. 参考

- http://blog.csdn.net/cjfeii/article/details/10084343
- http://blog.chinaunix.net/uid-20671208-id-3588619.html

